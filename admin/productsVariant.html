<!DOCTYPE html>
<html>
	<head>
		<!-- Standard Meta -->
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
		<link rel="icon" type="image/x-icon" href="../assets/PICS/TL_Favicon.png">
		<!-- Site Properities -->
		<title>Tulisan</title>

		<link href="../assets/css/bootstrap.min.css" rel="stylesheet">
		<link href="../assets/css/font-awesome.min.css" rel="stylesheet">
		<link href="../assets/css/syncard-inject.css" rel="stylesheet">
		<link href="../assets/css/admin.css" rel="stylesheet">
	</head>
	<body>
		<div class="container-fluid">
			<header class="parent-admin"></header>

			<main class="parent-admin"></main>

			<footer class="parent-admin"></footer>
		</div>

		<!-- Script collection -->
		<script type="text/javascript" src="../assets/js/jquery-3.2.1.min.js"></script>
		<script type="text/javascript" src="../assets/js/jquery-ui-1.10.0.custom.min.js"></script>
		<script type="text/javascript" src="../assets/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="../assets/js/syncard.js"></script>
		<script type="text/javascript" src="../assets/js/public.js"></script>

		<!-- page script -->
		<script type="text/javascript">
			$(function(){
				loadData();
			});
			function loadData(){
				var html = '';
				/* get ID */
				var id = "";
				var link = "";
				if(getParam('q') != "" && getParam('q') != null) {
					id 	 = getParam('q');
					link = '?s=' + getParam('q');
				}else{
					window.location.href = base_url + "/admin/product.html";
				}

				html = html +
				'<div class="operation-group">'+
					'<div class="form-inline">' +
						'<div class="input-group">' +
							'<a href="formProductVariant.html' + link + '"><i class="fa fa-plus-circle text-warning">&nbsp;</i> Add Variant</a>'+
						'</div>' +
						'<div class="input-group">' +
							'<a href="#" id="deleteButton"><i class="fa fa-minus-circle text-warning">&nbsp;</i> Delete Variant</a>'+
						'</div>' +
						'<div class="input-group operation-button">' +
							'<a href="#" id="manageButton"><i class="fa fa-bars text-warning">&nbsp;</i> Manage Variant</a>'+
						'</div>' +
						'<div class="input-group operation-button">' +
							'<a href="#" id="enableButton"><i class="fa fa-bars text-warning">&nbsp;</i> Publish Variant</a>'+
						'</div>' +
						'<div class="input-group operation-button">' +
							'<a href="#" id="disableButton"><i class="fa fa-bars text-warning">&nbsp;</i> Keep Variant</a>'+
						'</div>' +
	        	'<div class="input-group pull-right">' +
	        		'<input type="text" class="form-control" placeholder="Search">' +
		        	'<span class="input-group-btn">' +
		        		'<button type="button" class="search btn btn-default">SEARCH</button>' +
		        	'</span>' +
	        	'</div>' +
	   			'</div>' +
	        '<div class="clearfix"></div>' +
				'</div>';

				html = html +
					'<div class="summary-group">'+
						'<div class="summary-text">'+
							'<p>Total number of <b id="productGroups"></b> Variants</p>'+
							'<p class="number" id="totalRecord">0</p>'+
						'</div>'+
						'<div class="alpha">'+
							'<ul>' +
								'<li><a href="#">A</a></li>'+
								'<li><a href="#">B</a></li>'+
								'<li><a href="#">C</a></li>'+
								'<li><a href="#">D</a></li>'+
								'<li><a href="#">E</a></li>'+
								'<li><a href="#">F</a></li>'+
								'<li><a href="#">G</a></li>'+
								'<li><a href="#">H</a></li>'+
								'<li><a href="#">I</a></li>'+
								'<li><a href="#">J</a></li>'+
								'<li><a href="#">K</a></li>'+
								'<li><a href="#">L</a></li>'+
								'<li><a href="#">M</a></li>'+
								'<li><a href="#">N</a></li>'+
								'<li><a href="#">O</a></li>'+
								'<li><a href="#">P</a></li>'+
								'<li><a href="#">Q</a></li>'+
								'<li><a href="#">R</a></li>'+
								'<li><a href="#">S</a></li>'+
								'<li><a href="#">T</a></li>'+
								'<li><a href="#">U</a></li>'+
								'<li><a href="#">V</a></li>'+
								'<li><a href="#">W</a></li>'+
								'<li><a href="#">X</a></li>'+
								'<li><a href="#">Z</a></li>'+
							'</ul>'+
						'</div>'+
					'</div>'+
					'<p class="pagging-text"><a href="#" class="pagging-left">< Previous page</a> | <a href="#" class="pagging-right">Next page ></a></p>' ;
				html = html +
				'<div class="table-frame">'+
					'<div class="data-list">';

				html = html +
					'</div>'+
				'</div>';
				html = html +
				'<p class="pagging-text"><a href="#" class="pagging-left">< Previous page</a> | <a href="#" class="pagging-right">Next page ></a></p>'+
				'<div class="ext-group">'+
					'<div class="alpha">'+
						'<ul>' +
							'<li><a href="#">A</a></li>'+
							'<li><a href="#">B</a></li>'+
							'<li><a href="#">C</a></li>'+
							'<li><a href="#">D</a></li>'+
							'<li><a href="#">E</a></li>'+
							'<li><a href="#">F</a></li>'+
							'<li><a href="#">G</a></li>'+
							'<li><a href="#">H</a></li>'+
							'<li><a href="#">I</a></li>'+
							'<li><a href="#">J</a></li>'+
							'<li><a href="#">K</a></li>'+
							'<li><a href="#">L</a></li>'+
							'<li><a href="#">M</a></li>'+
							'<li><a href="#">N</a></li>'+
							'<li><a href="#">O</a></li>'+
							'<li><a href="#">P</a></li>'+
							'<li><a href="#">Q</a></li>'+
							'<li><a href="#">R</a></li>'+
							'<li><a href="#">S</a></li>'+
							'<li><a href="#">T</a></li>'+
							'<li><a href="#">U</a></li>'+
							'<li><a href="#">V</a></li>'+
							'<li><a href="#">W</a></li>'+
							'<li><a href="#">X</a></li>'+
							'<li><a href="#">Z</a></li>'+
						'</ul>'+
					'</div>'+
				'</div>';

				$('main.parent-admin .main-content').append(html);

				r_setCookie('adminPageFilter', '1');
				r_setCookie('adminAlphaFilter', '');
				var page = (r_getCookie('adminPageFilter') != "" ? r_getCookie('adminPageFilter'): "1");
				var data = p_getData('operation', 'productVariant', page, 'productId = "' + id + '"');
				data = data.feedData;

				dataGenerator(data);

				//filter
				$('.alpha a').on("click", function(){
					var page = (r_getCookie('adminPageFilter') != "" ? r_getCookie('adminPageFilter'): "1");
					var data = p_getData('operation', 'productVariant', page, '(a.name LIKE "' + $(this).html() + '%") AND productId = "' + id + '"');
					data = data.feedData;
					dataGenerator(data);

					r_setCookie('adminPageFilter', page);
					r_setCookie('adminAlphaFilter', $(this).html());
				});

				$('button.search').on("click", function(){
					var keyword = $("[placeholder='Search']").val();
					var data = p_getData('operation', 'productVariant', '1', '(a.name LIKE "%' + keyword + '%" OR v.sku LIKE "%' + keyword + '%") AND productId = "' + id + '"');
					data = data.feedData;
					dataGenerator(data);
				});

				$("[placeholder='Search']").on("keypress", function(e){
					var keycode = e.keyCode || e.which;
					if(keycode == '13') {
						var keyword = $("[placeholder='Search']").val();
						var data = p_getData('operation', 'productVariant', '1', '(a.name LIKE "%' + keyword + '%" OR v.sku LIKE "%' + keyword + '%") AND productId = "' + id + '"');
						data = data.feedData;
						dataGenerator(data);
					}
				});

				//filter end

				//paging
				$('.pagging-text .pagging-right').on("click", function(){
					var page = (r_getCookie('adminPageFilter') != "" ? r_getCookie('adminPageFilter'): "1");
					page = parseInt(page) + 1;

					var keyword = $("[placeholder='Search']").val();
					var alpha = (r_getCookie('adminAlphaFilter') != "" ? '(a.name LIKE "' + r_getCookie('adminAlphaFilter') + '%") AND ': "");

					var data = p_getData('operation', 'productVariant', page, alpha + '(a.name LIKE "%' + keyword + '%" OR v.sku LIKE "%' + keyword + '%") AND productId = "' + id + '"');
					data = data.feedData;

					if(data.length > 0){ dataGenerator(data); } else { page = parseInt(page) - 1; }

					r_setCookie('adminPageFilter', page);
				});

				$('.pagging-text .pagging-left').on("click", function(){
					var page = (r_getCookie('adminPageFilter') != "" ? r_getCookie('adminPageFilter'): "1");
					if(page > 1){
						page = parseInt(page) - 1;

						var keyword = $("[placeholder='Search']").val();
						var data = p_getData('operation', 'productVariant', page, '(a.name LIKE "%' + keyword + '%" OR v.sku LIKE "%' + keyword + '%") AND productId = "' + id + '"');
						data = data.feedData;
						dataGenerator(data);

						r_setCookie('adminPageFilter', page);
					}
				});
				//paging end
			}

			function dataGenerator(data){
				var html = "";
				for(var loop =0; loop<data.length; loop++){

					data[loop].frontPicture = (data[loop].frontPicture != "") ? "../assets/products/large/" + data[loop].frontPicture : "../assets/default/no.gif";

	    		html = html +
	    		'<div class="col-md-3 border-all ' + ((parseInt(data[loop].qty) <= 0) ? 'danger' : '') + '">'+
						'<br/>' +
	    			'<input type="checkbox" name="customerSelect" value="'+data[loop].idData+'" id="selectRecord' + loop + '"><label for="selectRecord' + loop + '"></label>'+
	    			'<img class="big-image" src="'+ data[loop].frontPicture +'">'+
						'<hr/>' +
	    			'<p class="text-center">'+ ((data[loop].sku!=null && data[loop].sku!="") ? data[loop].sku : '<b>- NO SKU -</b>') +'</p>'+
	    			'<p class="text-center">'+
							((data[loop].artwork!=null) ? data[loop].artwork : '<b>- NO ARTWORK -</b>') + ' | ' +
							((data[loop].color!=null) ? data[loop].color : '<b>- NO COLOR -</b>') +
						'</p>'+
	    			'<p class="text-center">'+ ((data[loop].status!= '0') ? 'Show in store' : '<b>- DRAFT -</b>') +'</p>'+
						'<p class="text-center">'+ ((data[loop].size!='NULL') ? data[loop].size : '<b>- NO SIZE -</b>') +'</p>'+
	    			'<p class="text-center">Remaining : '+ data[loop].qty +'</p>'+
	    			// '<p class="text-center">'+ currencyFormat(String(data[loop].price)) +'</p>'+
	    		'</div>';
	    	}

				html = html + '<div class="clearfix"></div>';

				$('main.parent-admin .data-list').html('').append(html);
				$('main.parent-admin #totalRecord').html(data.length);

				//
				$('#productGroups').html(data[0].name);

				//activator
				checkboxActivator();
				operationActivator();
			}

			function operationActivator(){
				$('#deleteButton').unbind().on("click", function(){
					if(checkedArray.length > 0){
						var confirmation = confirm("Are you sure you want to delete the selected data?");
						if (confirmation == true) {
							p_removeData('operation', 'productVariant', checkedArray);

							r_setCookie('adminPageFilter', '1');
							r_setCookie('adminAlphaFilter', '');
							var page = (r_getCookie('adminPageFilter') != "" ? r_getCookie('adminPageFilter'): "1");
							var id 	 = getParam('q');
							var data = p_getData('operation', 'productVariant', page, 'productId = "' + id + '"');
									data = data.feedData;

							dataGenerator(data);
						}
					}else{
						alert("Please choose record first!");
					}
				});

				$('#enableButton').unbind().on("click", function(){
					if(checkedArray.length > 0){
						var confirmation = confirm("Are you sure you want publish the selected variant?");
						if (confirmation == true) {
							var res = p_changeData('operation', 'publishVariant', checkedArray);

							if(res.feedStatus == "success"){
								r_setCookie('adminPageFilter', '1');
								r_setCookie('adminAlphaFilter', '');
								var page = (r_getCookie('adminPageFilter') != "" ? r_getCookie('adminPageFilter'): "1");
								var id 	 = getParam('q');
								var data = p_getData('operation', 'productVariant', page, 'productId = "' + id + '"');
									  data = data.feedData;

								dataGenerator(data);
							}
						}
					}else{
						alert("Please choose record first!");
					}
				});

				$('#disableButton').unbind().on("click", function(){
					if(checkedArray.length > 0){
						var confirmation = confirm("Are you sure you want keep the selected variant?");
						if (confirmation == true) {
							var res = p_changeData('operation', 'keepVariant', checkedArray);

							if(res.feedStatus == "success"){
								r_setCookie('adminPageFilter', '1');
								r_setCookie('adminAlphaFilter', '');
								var page = (r_getCookie('adminPageFilter') != "" ? r_getCookie('adminPageFilter'): "1");
								var id 	 = getParam('q');
								var data = p_getData('operation', 'productVariant', page, 'productId = "' + id + '"');
									  data = data.feedData;

								dataGenerator(data);
							}
						}
					}else{
						alert("Please choose record first!");
					}
				});

				$('#manageButton').unbind().on("click", function(){
					if(checkedArray.length == 1 && checkedArray[0] != "0"){
						window.location.href = base_url + "/admin/formProductVariant.html?q=" + checkedArray[0] + "&s=" + getParam('q');
					}else{
						alert("Please choose only one record!");
					}
				});

			}
		</script>
	</body>
</html>
